webpackJsonp([13],{1615:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2241);n.d(t,"default",function(){return r.a})},2100:function(e,t,n){"use strict";function r(){return i.a.createElement("div",null,i.a.createElement(o.a,null,"Access denied!"),i.a.createElement("p",null,"Unfortunately you do not have access to this functionality."))}t.a=r;var a=n(0),i=n.n(a),o=n(153)},2241:function(e,t,n){"use strict";function r(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){function r(a,i){try{var o=t[a](i),s=o.value}catch(e){return void n(e)}if(!o.done)return Promise.resolve(s).then(function(e){r("next",e)},function(e){r("throw",e)});e(s)}return r("next")})}}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e){return e}function o(e,t){D.take(1).subscribe(function(e){var r=[],a=e.selectedLeft.map(function(e){return e.id}).indexOf(t.id);r=a>=0?e.selectedLeft.slice(0,a).concat(e.selectedLeft.slice(a+1)):e.selectedLeft.concat([t]),n.i(L.c)({hierarchy:B({},e,{reload:[],selectedLeft:r})})})}function s(e,t){n.i(L.c)({hierarchy:B({},e,{isProcessing:t})})}function c(e){return D.take(1).combineLatest(W).flatMap(function(t){var n=C(t,2),r=n[0],a=n[1];e.parent={id:r.selectedRight[0]&&r.selectedRight[0].id};var i=e.save().then(function(){return a.i18n.getTranslation("successfully_moved_$$ouName$$",{ouName:e.displayName})}).catch(function(t){return a.i18n.getTranslation("failed_to_move_$$ouName$$_($$errorMessage$$)",{ouName:e.displayName,errorMessage:t})});return U.Observable.fromPromise(i)})}function l(){D.take(1).do(function(e){return s(e,!0)}).map(function(e){return(e.selectedLeft||[]).map(function(e){return e.id})}).flatMap(function(e){return U.Observable.fromPromise(H(e)).flatMap(i)}).map(c).concatAll().subscribe(function(e){M.a.show({message:e,translate:!1});var t=Object.assign({},L.b.state.hierarchy);n.i(L.c)({hierarchy:B({},t,{isProcessing:!1,reload:[].concat(t.selectedRight.map(function(e){return e.id})).concat(t.selectedLeft.map(function(e){return e.parent&&e.parent.id?e.parent.id:L.b.state.hierarchy.leftRoots.concat(L.b.state.hierarchy.rightRoots).map(function(e){return e.id}).filter(function(t){return new RegExp(t).test(e.path)}).reduce(function(e){return e})}))})})},function(e){s(L.b.state.hierarchy,!1)},function(){var e=Object.assign({},L.b.state.hierarchy);e.selectedLeft=[],e.selectedRight=[],e.initiallySelected=[],n.i(L.c)({hierarchy:B({},e,{isProcessing:!1})})})}function u(e,t){D.take(1).subscribe(function(e){return n.i(L.c)({hierarchy:B({},e,{reload:[],selectedRight:[t]})})})}function d(e,t){var n={title:{color:"#666",marginBottom:".5rem"},message:{color:"#666",padding:".5rem",display:"block"},list:{paddingLeft:"1.5rem"}},r=e.organisationUnits.map(function(e){return v.a.createElement("li",{key:e.id},e.displayName)}),a=v.a.createElement("span",{style:n.message},t.d2.i18n.getTranslation(e.noOrganisationUnitsMessage));return v.a.createElement("div",{style:e.style},v.a.createElement("div",{style:n.title},t.d2.i18n.getTranslation(e.title)),r.length?v.a.createElement("ul",{style:n.list},r):a)}function f(e,t,n){return e.map(n).some(function(e){return t.map(n).indexOf(e)>=0})}function h(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").split("/").filter(function(e){return e})}function m(e,t){if(e.some(function(e){return!e.path})||t.some(function(e){return!e.path}))return A.a.warn("No path found, so can not run hierarchy validation"),!0;if(1!==t.length)return A.a.warn("More than/less than 1 target found, can not move."),!0;var n=t[0];return e.some(function(e){return h(n.path).indexOf(e.id)>=0})}function p(e){return e.isProcessing||!e.selectedLeft.length||!e.selectedRight.length||f(e.selectedLeft,e.selectedRight,function(e){return e&&e.id})||m(e.selectedLeft,e.selectedRight)}function g(e,t){var n={wrap:{flex:1,display:"flex",flexOrientation:"row",margin:"1rem 0"},ouTreeLeft:{flex:1,marginRight:"2rem",padding:"1rem"},ouTreeRight:{flex:1,padding:"1rem"},moveButton:{width:"100%",marginBottom:"1rem",marginTop:"1rem"},pendingOperationsWrap:{padding:"1rem",margin:"1rem 0"},pendingOperationsListsWrap:{display:"flex",flexDirection:"row"},pendingOperationsList:{flex:1,padding:".5rem"},errorMessage:{color:"orange",lineHeight:"1.5rem",padding:"1rem 0",display:"flex",alignItems:"flex-end"},errorIcon:{color:"orange"}};if(!t.d2.currentUser.authorities.has("F_ORGANISATIONUNIT_MOVE"))return v.a.createElement(j.a,null);var r=t.d2.i18n.getTranslation("move_$$ouCount$$_organisation_units",{ouCount:e.selectedLeft&&e.selectedLeft.length||0}),a=t.d2.i18n.getTranslation("hierarchy_operations"),i=t.d2.i18n.getTranslation("you_can_not_move_higher_level_organisation_units_to_its_descendants");return v.a.createElement("div",null,v.a.createElement($.a,null,a),v.a.createElement("div",{style:n.wrap},v.a.createElement(_.a,{style:n.ouTreeLeft},v.a.createElement(O.a,{roots:e.leftRoots,initiallyExpanded:e.initiallyExpanded,selected:e.selectedLeft.map(function(e){return e.path}),onSelectClick:o,onUpdateInput:function(e){return G(e)},idsThatShouldBeReloaded:e.reload,noHitsLabel:t.d2.i18n.getTranslation("no_matching_organisation_units")})),v.a.createElement(_.a,{style:n.ouTreeRight},v.a.createElement(O.a,{roots:e.rightRoots,selected:e.selectedRight.map(function(e){return e.path}),initiallyExpanded:e.initiallyExpanded,onSelectClick:u,onUpdateInput:function(e){return F(e)},idsThatShouldBeReloaded:e.reload,noHitsLabel:t.d2.i18n.getTranslation("no_matching_organisation_units"),hideCheckboxes:!0,hideMemberCount:!0}))),v.a.createElement(_.a,{style:n.pendingOperationsWrap},v.a.createElement("div",{style:n.pendingOperationsListsWrap},v.a.createElement(V,{style:n.pendingOperationsList,organisationUnits:e.selectedLeft,noOrganisationUnitsMessage:"select_organisation_units_to_move_from_the_left_tree",title:"move"}),v.a.createElement(V,{style:n.pendingOperationsList,organisationUnits:e.selectedRight,noOrganisationUnitsMessage:"select_new_parent_for_organisation_units_from_the_right_tree",title:"new_parent"}))),e.selectedLeft.length&&e.selectedRight.length&&m(e.selectedLeft||[],e.selectedRight||[])?v.a.createElement("div",{style:n.errorMessage},v.a.createElement(S.a,{style:n.errorIcon,className:"material-icons"},"warning"),i):null,v.a.createElement(w.a,{primary:!0,style:n.moveButton,label:r,onClick:l,disabled:p(e)}))}var y=n(0),v=n.n(y),b=n(154),_=n.n(b),O=n(726),R=n(215),L=n(64),E=n(41),x=n(98),w=n.n(x),T=n(34),P=n(15),U=(n.n(P),n(16)),M=(n.n(U),n(62)),$=n(153),k=n(725),N=n(20),A=n.n(N),I=n(217),S=n.n(I),j=n(2100),C=function(){function e(e,t){var n=[],r=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{!r&&s.return&&s.return()}finally{if(a)throw i}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),B=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},H=function(){var e=r(regeneratorRuntime.mark(function e(t){var r,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.i(P.getInstance)();case 2:return r=e.sent,e.next=5,r.models.organisationUnit.list({filter:["id:in:["+t.join(",")+"]"],fields:":owner,href,id,parent,displayName,path,children[id,displayName,path]"});case 5:return a=e.sent,e.abrupt("return",a.toArray());case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),W=U.Observable.fromPromise(n.i(P.getInstance)()),D=L.b.map(function(e){return e.hierarchy||{}}),F=E.a.create("rightTreeSearch","Hierarchy"),G=E.a.create("leftTreeSearch","Hierarchy");U.Observable.merge(G.map(function(e){return B({},e,{side:"left"})}).debounceTime(400),F.map(function(e){return B({},e,{side:"right"})}).debounceTime(400)).filter(function(e){return e.data}).map(function(e){var t=e.complete,r=e.error,a=e.data,i=e.side;return U.Observable.fromPromise(n.i(k.a)(a,50)).map(function(e){return{complete:t,error:r,organisationUnits:e,side:i}})}).concatAll().flatMap(function(e){return U.Observable.of(e).combineLatest(D.take(1),function(e,t){return{result:e,hierarchy:t}})}).subscribe(function(e){var t=e.result;e.hierarchy;n.i(L.c)({hierarchy:B({},L.b.state.hierarchy,a({},t.side+"Roots",t.organisationUnits))})}),U.Observable.merge(G.filter(function(e){return!e.data}).map(function(){return"left"}),F.filter(function(e){return!e.data}).map(function(){return"right"})).flatMap(function(e){return L.b.take(1).map(function(t){return{side:e,state:t}})}).subscribe(function(e){var t=e.side,r=e.state;n.i(L.c)({hierarchy:B({},r.hierarchy,a({},t+"Roots",r.userOrganisationUnits.toArray()))})});var J=L.b.map(function(e){var t=e.hierarchy,n=void 0===t?{}:t,r=e.userOrganisationUnits;return{roots:r.toArray(),leftRoots:n.leftRoots,rightRoots:n.rightRoots,initiallyExpanded:r.toArray().map(function(e){return e.path}),selectedLeft:n.selectedLeft||[],selectedRight:n.selectedRight||[],isProcessing:n.isProcessing,reload:n.reload}});E.a.create("operationsCompleted","Hierarchy");d.defaultProps={organisationUnits:[]};var V=n.i(T.a)(d);g.defaultProps={selectedLeft:[],selectedRight:[]},t.a=n.i(R.a)(J,n.i(T.a)(g))}});
//# sourceMappingURL=13-d3b981caa3eb21697c96.js.map